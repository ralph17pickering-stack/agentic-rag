# Plan: Clear Chat Button

✅ **Simple** - Single-pass executable, low risk

## Goal
Add a "Clear Chat" button to the chat UI that permanently deletes all messages in the current thread (keeps the thread itself).

## Tasks

### 1. Backend: DELETE /api/threads/{thread_id}/messages endpoint
- Add a new route in `backend/routers/threads.py` (or wherever thread routes live)
- Endpoint: `DELETE /api/threads/{thread_id}/messages`
- Auth: JWT required, RLS ensures user owns the thread
- Implementation: delete all rows from `messages` where `thread_id = :thread_id`
- Returns 204 No Content on success
- **Validation**: curl with auth token returns 204; messages table has 0 rows for that thread

### 2. Frontend: API call in useThreads or useChatMessages hook
- Add `clearMessages(threadId)` function that calls `DELETE /api/threads/:id/messages`
- **Validation**: function exists and is exported

### 3. Frontend: Clear Chat button in UI
- Place button in the chat header area (near thread title)
- Show a confirmation dialog before proceeding (e.g. `window.confirm` or shadcn AlertDialog)
- On confirm: call `clearMessages`, then clear local message state
- Button only shown when a thread is active and has messages
- **Validation**: button visible in chat header, clicking → confirm → messages disappear from UI

## File Locations (to verify)
- Backend threads router: `backend/routers/threads.py`
- Frontend hooks: `frontend/src/hooks/`
- Frontend chat layout: `frontend/src/components/ChatLayout.tsx` or similar

## Gotchas
- Use `supabase_service_client` or the user-scoped client — since messages RLS is per-user, the user-scoped client with the JWT should work fine
- Clear the local React state immediately after the API call (optimistic UI)
- Don't navigate away — stay on the (now-empty) thread
