# 8. UX Redesign: UK-Centric Behaviour & Interaction Flow

**Complexity:** ğŸ”´ **Complex** - Touches every layout component, adds responsive system, theme toggle, new panel mechanics

---

## Design Principles

Inspired by GOV.UK design patterns: **clarity over cleverness**, predictable navigation, no hidden essential functionality, comfortable in varied lighting conditions.

- Every interactive element has a visible label (not icon-only on desktop)
- Panels announce their state clearly â€” no ambiguous toggles
- Layout adapts gracefully â€” users never relearn the interface across devices
- Theme respects system preference, then user override

---

## 1. Core User Journeys

### Journey A: Start a New Chat (Minimal UI)

**Desktop:** User lands on a clean single-column chat view. Left sidebar is collapsed to a narrow rail (icons only, ~48px). Right panel is hidden entirely. The full width is given to the chat area. A prominent "New chat" button sits at the top of the icon rail. The message input is centred with comfortable max-width (~720px).

**Mobile:** User sees only the chat view. Bottom tab bar shows: **Chat** (active), **History**, **Results**. No panels visible. Input is pinned to bottom above the tab bar.

### Journey B: Reveal Left Panel (History, Agents, Settings)

**Desktop:** User clicks the rail icon or presses `Ctrl+B`. The left panel slides out to 280px over 200ms (ease-out). It overlays the chat area (does not push it). A subtle scrim covers the chat. Clicking the scrim or pressing Escape closes the panel. Optionally, user can "pin" it open â€” this pushes the chat area right and the pin icon toggles to "unpin".

**Tablet:** Same as desktop but panel is always overlay (never pinned) to preserve chat width.

**Mobile:** User taps "History" tab. The view switches fully to the history list. Tapping a thread returns to Chat tab with that thread loaded. No split view.

### Journey C: View Web Results (Right Panel)

**Desktop:** When the LLM returns web results, a subtle toast appears: "3 web results found â€” View". Clicking "View" slides the right panel in (320px, overlay, 200ms ease-out). User can browse results, click to expand snippets, "Save to KB". Clicking the close button or the scrim dismisses it. The panel also has a small persistent tab/handle on the right edge when collapsed, labelled "Results (3)" so users can re-open.

**Mobile:** When web results arrive, the "Results" tab in the bottom bar shows a badge (dot or count). Tapping it switches to a full-screen results view. User taps "Chat" tab to return.

### Journey D: Documents View

**Desktop:** Clicking "Documents" in the header replaces the chat area with the documents panel. Left rail remains visible. Right panel hidden.

**Mobile:** "Documents" is accessible from a hamburger/overflow menu in the header (not a bottom tab â€” it's secondary navigation). Opens as a full-screen view with a back arrow to return.

---

## 2. State Transitions & Micro-Interactions

### Panel States

| Panel | States | Trigger |
|-------|--------|---------|
| Left sidebar | `collapsed` (rail) / `open-overlay` / `open-pinned` | Rail click, Ctrl+B, pin button |
| Right sidebar | `hidden` / `open-overlay` | Web results event, edge tab, toast action |
| Both panels | Never both pinned simultaneously on <1440px | Auto-close right if left is pinned on narrow screens |

### Transitions

| Transition | Duration | Easing | Detail |
|------------|----------|--------|--------|
| Panel slide in | 200ms | ease-out | `transform: translateX()` â€” no layout reflow for overlay |
| Panel slide out | 150ms | ease-in | Slightly faster close feels snappy |
| Scrim fade | 200ms | linear | `opacity: 0 â†’ 0.3` (dark semi-transparent) |
| Pin/unpin reflow | 250ms | ease-in-out | Chat area width animates via flex transition |
| Theme toggle | 150ms | ease | `transition: background-color, color` on `*` â€” brief, not jarring |
| Mobile tab switch | 0ms | instant | No animation â€” tabs should feel immediate like native apps |
| Badge appear | 300ms | spring | Scale from 0 â†’ 1 with slight overshoot |

### Theme Toggle Behaviour

1. On first load: read `localStorage.getItem('theme')`. If null, use `prefers-color-scheme` media query.
2. Toggle cycles: **System** â†’ **Light** â†’ **Dark** â†’ **System**. Three-state, shown as icon (monitor/sun/moon) + label.
3. Toggling writes to `localStorage` and applies `.dark` / `.light` class on `<html>`.
4. `next-themes` (already installed) handles this â€” just needs `<ThemeProvider attribute="class" defaultTheme="system">` in App.tsx.
5. Toggle location: right side of the header, before the user menu dropdown.

### Mobile-Specific Interactions

- **Bottom tab bar:** 3 tabs â€” Chat, History, Results. Fixed at bottom, 56px height, safe-area-inset padding for notched phones.
- **Active tab indicator:** Bold label + filled icon (inactive = outline icon + muted label). No underline â€” UK users are accustomed to filled/outline icon states.
- **Results badge:** Small red dot (not a number) â€” appears when new results arrive while on another tab. Clears when tab is visited.
- **Pull-to-refresh on History tab:** Reloads thread list. Standard mobile pattern.
- **Swipe-to-delete on threads:** Left swipe reveals red "Delete" button. Requires explicit tap â€” no swipe-through deletion.

---

## 3. Layout Maps

### Desktop (>=1024px)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header  [â‰¡ToggleLeft]  Chat | Docs     [â˜€/ğŸŒ™] [Userâ–¾] â”‚  h-14
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Railâ”‚                                        â”‚(Right     â”‚
â”‚48pxâ”‚         Chat / Message Area            â”‚ panel     â”‚
â”‚    â”‚         (centred, max-w-3xl)           â”‚ 320px     â”‚
â”‚ â‰¡  â”‚                                        â”‚ overlay   â”‚
â”‚ +  â”‚                                        â”‚ when      â”‚
â”‚ ğŸ“ â”‚                                        â”‚ active)   â”‚
â”‚ âš™  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚           â”‚
â”‚    â”‚  â”‚  Message input               â”‚      â”‚           â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚           â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Left panel expanded (overlay):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Left     â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
â”‚ Panel    â”‚â–‘â–‘â–‘â–‘â–‘  Chat area (dimmed by scrim)  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
â”‚ 280px    â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
â”‚          â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
â”‚ [Pin ğŸ“Œ] â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
â”‚ History  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
â”‚ Agents   â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
â”‚ Settings â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Left panel pinned:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Left     â”‚                                              â”‚
â”‚ Panel    â”‚       Chat area (pushed right,               â”‚
â”‚ 280px    â”‚       still centred within remaining space)   â”‚
â”‚ pinned   â”‚                                              â”‚
â”‚          â”‚                                              â”‚
â”‚ [Unpin]  â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tablet (768pxâ€“1023px)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header  [â‰¡]  Chat | Docs  [â˜€/ğŸŒ™] [Userâ–¾]â”‚  h-14
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Railâ”‚                                    â”‚
â”‚48pxâ”‚     Chat / Message Area            â”‚
â”‚    â”‚     (full width minus rail)        â”‚
â”‚    â”‚                                    â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚  â”‚  Message input           â”‚      â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Panels: always overlay, never pinned.
```

### Mobile (<768px)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header  [â‹®]  App Name   â”‚  h-12 (compact)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚   Chat / Message Area   â”‚
â”‚   (full width, padded)  â”‚
â”‚                         â”‚
â”‚                         â”‚
â”‚                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Message input          â”‚  Pinned above tabs
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¬ Chat  ğŸ“‹ History  ğŸ” Results â”‚  h-14 (bottom tabs)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

History tab selected:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+ New Chat]            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Thread: "Budget Q3..."  â”‚
â”‚ Thread: "Policy rev..." â”‚
â”‚ Thread: "Meeting no..." â”‚
â”‚ ...                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¬ Chat  ğŸ“‹ History  ğŸ” Results â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Results tab selected:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Web result 1            â”‚
â”‚   snippet...  [Save]    â”‚
â”‚ Web result 2            â”‚
â”‚   snippet...  [Save]    â”‚
â”‚ ...                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¬ Chat  ğŸ“‹ History  ğŸ” Results â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Clarity & Trust (UK Design Influence)

### GOV.UK-Inspired Patterns Applied

| Principle | Application |
|-----------|-------------|
| **One thing per page** (mobile) | Each mobile tab shows one concern â€” no cramped split views |
| **Clear labels** | "History & tools" not just â‰¡. "Web results" not just ğŸ”. Icons always paired with text on desktop |
| **No surprise navigation** | Panels overlay â€” they don't rearrange the page. User's place in chat is preserved |
| **Progressive disclosure** | Default is minimal chat. Complexity (panels, results, settings) is one click away |
| **Consistent placement** | Left = navigation/history (conventional). Right = supplementary content. Top = global actions |
| **Visible state** | Pinned panel has a visible indicator. Active tab is clearly highlighted. Theme state shown as icon |
| **Accessible contrast** | Both themes use oklch colours tuned for WCAG AA. Dark mode avoids pure black (#000) â€” uses soft dark (oklch ~0.15) |
| **Keyboard navigable** | Ctrl+B = left panel. Escape = close any panel. Tab order follows visual order |

### Trust Signals

- No auto-hiding of controls â€” everything that was visible stays reachable
- Actions are explicit â€” "Save to KB" requires a click, not auto-ingestion
- Delete operations require confirmation (thread delete, document delete)
- Theme respects system preference by default â€” the app doesn't impose a look

---

## 5. Component Mapping (What Changes)

| Current Component | Change |
|-------------------|--------|
| `App.tsx` | Add `ThemeProvider`, responsive breakpoint context, mobile tab state |
| `Header.tsx` | Add theme toggle, responsive hamburger for mobile, rail toggle button |
| `ThreadSidebar.tsx` | Refactor â†’ `LeftPanel.tsx` with rail/overlay/pinned states, add Agents & Settings sections |
| `WebResultsSidebar.tsx` | Refactor â†’ `RightPanel.tsx` with overlay behaviour, edge tab handle, toast trigger |
| `ChatLayout.tsx` | Add scrim overlay, panel state management, keyboard shortcuts |
| `MessageArea.tsx` | Minor â€” ensure max-width centres properly in all panel states |
| `MessageInput.tsx` | Minor â€” mobile-safe bottom positioning |
| **New:** `BottomTabs.tsx` | Mobile-only tab bar (Chat / History / Results) |
| **New:** `MobileHistoryView.tsx` | Full-screen thread list for mobile History tab |
| **New:** `MobileResultsView.tsx` | Full-screen web results for mobile Results tab |
| **New:** `useBreakpoint.ts` | Hook returning `mobile` / `tablet` / `desktop` from `matchMedia` |
| **New:** `usePanelState.ts` | Hook managing left/right panel open/closed/pinned state |

---

## 6. Implementation Order

1. **Theme system** â€” Wire up `next-themes`, add toggle to header. Quick win, low risk.
2. **Breakpoint hook** â€” `useBreakpoint()` using `matchMedia` listeners.
3. **Left panel refactor** â€” Rail â†’ overlay â†’ pinned states. Desktop + tablet.
4. **Right panel refactor** â€” Overlay with edge tab handle. Toast trigger for web results.
5. **Scrim & keyboard shortcuts** â€” Overlay scrim, Escape to close, Ctrl+B.
6. **Mobile layout** â€” Bottom tabs, full-screen History/Results views, header compaction.
7. **Polish** â€” Transitions, badge on Results tab, pull-to-refresh, swipe-to-delete.

---

## Unresolved Questions

1. **Agents/tools section in left panel** â€” Module 8 (Sub-Agents) isn't built yet. Should the left panel include a placeholder "Agents" section now, or add it when Module 8 lands?
2. **Settings in left panel** â€” What settings should be accessible here? Just theme? Or also search mode, reranking toggle, etc.?
3. **Pin persistence** â€” Should the left panel's pinned state persist across sessions (localStorage) or reset to collapsed on each visit?
4. **Documents nav on mobile** â€” Proposed as a hamburger menu item rather than a bottom tab (to keep tabs to 3). Is this acceptable, or should Documents be a 4th tab?
5. **Animation library** â€” Plain CSS transitions, or use Framer Motion for more control over spring physics and gesture handling (swipe-to-delete etc.)?
